import{r as s,d as M,a as E,j as l,c as y}from"./index-CmuHx8sp.js";const C={Clubs:0,Diamonds:1,Hearts:2,Spades:3},v={MoveIndividually:0,MoveAllNextSiblings:1},L="data:image/svg+xml,%3c?xml%20version='1.0'%20encoding='UTF-8'%20standalone='no'?%3e%3csvg%20xmlns='http://www.w3.org/2000/svg'%20xmlns:xlink='http://www.w3.org/1999/xlink'%20class='card'%20face='2C'%20height='3.5in'%20preserveAspectRatio='none'%20viewBox='-120%20-168%20240%20336'%20width='2.5in'%3e%3cdefs%3e%3csymbol%20id='SC2'%20viewBox='-600%20-600%201200%201200'%20preserveAspectRatio='xMinYMid'%3e%3cpath%20d='M30%20150C35%20385%2085%20400%20130%20500L-130%20500C-85%20400%20-35%20385%20-30%20150A10%2010%200%200%200%20-50%20150A210%20210%200%201%201%20-124%20-51A10%2010%200%200%200%20-110%20-65A230%20230%200%201%201%20110%20-65A10%2010%200%200%200%20124%20-51A210%20210%200%201%201%2050%20150A10%2010%200%200%200%2030%20150Z'%20fill='black'%3e%3c/path%3e%3c/symbol%3e%3csymbol%20id='VC2'%20viewBox='-500%20-500%201000%201000'%20preserveAspectRatio='xMinYMid'%3e%3cpath%20d='M-225%20-225C-245%20-265%20-200%20-460%200%20-460C%20200%20-460%20225%20-325%20225%20-225C225%20-25%20-225%20160%20-225%20460L225%20460L225%20300'%20stroke='black'%20stroke-width='80'%20stroke-linecap='square'%20stroke-miterlimit='1.5'%20fill='none'%3e%3c/path%3e%3c/symbol%3e%3c/defs%3e%3crect%20width='239'%20height='335'%20x='-119.5'%20y='-167.5'%20rx='12'%20ry='12'%20fill='white'%20stroke='black'%3e%3c/rect%3e%3cuse%20xlink:href='%23VC2'%20height='32'%20width='32'%20x='-114.4'%20y='-156'%3e%3c/use%3e%3cuse%20xlink:href='%23SC2'%20height='26.769'%20width='26.769'%20x='-111.784'%20y='-119'%3e%3c/use%3e%3cuse%20xlink:href='%23SC2'%20height='70'%20width='70'%20x='-35'%20y='-135.588'%3e%3c/use%3e%3cg%20transform='rotate(180)'%3e%3cuse%20xlink:href='%23VC2'%20height='32'%20width='32'%20x='-114.4'%20y='-156'%3e%3c/use%3e%3cuse%20xlink:href='%23SC2'%20height='26.769'%20width='26.769'%20x='-111.784'%20y='-119'%3e%3c/use%3e%3cuse%20xlink:href='%23SC2'%20height='70'%20width='70'%20x='-35'%20y='-135.588'%3e%3c/use%3e%3c/g%3e%3c/svg%3e",f="data:image/svg+xml,%3c?xml%20version='1.0'%20encoding='UTF-8'%20standalone='no'?%3e%3csvg%20xmlns='http://www.w3.org/2000/svg'%20xmlns:xlink='http://www.w3.org/1999/xlink'%20class='card'%20face='2D'%20height='3.5in'%20preserveAspectRatio='none'%20viewBox='-120%20-168%20240%20336'%20width='2.5in'%3e%3cdefs%3e%3csymbol%20id='SD2'%20viewBox='-600%20-600%201200%201200'%20preserveAspectRatio='xMinYMid'%3e%3cpath%20d='M-400%200C-350%200%200%20-450%200%20-500C0%20-450%20350%200%20400%200C350%200%200%20450%200%20500C0%20450%20-350%200%20-400%200Z'%20fill='red'%3e%3c/path%3e%3c/symbol%3e%3csymbol%20id='VD2'%20viewBox='-500%20-500%201000%201000'%20preserveAspectRatio='xMinYMid'%3e%3cpath%20d='M-225%20-225C-245%20-265%20-200%20-460%200%20-460C%20200%20-460%20225%20-325%20225%20-225C225%20-25%20-225%20160%20-225%20460L225%20460L225%20300'%20stroke='red'%20stroke-width='80'%20stroke-linecap='square'%20stroke-miterlimit='1.5'%20fill='none'%3e%3c/path%3e%3c/symbol%3e%3c/defs%3e%3crect%20width='239'%20height='335'%20x='-119.5'%20y='-167.5'%20rx='12'%20ry='12'%20fill='white'%20stroke='black'%3e%3c/rect%3e%3cuse%20xlink:href='%23VD2'%20height='32'%20width='32'%20x='-114.4'%20y='-156'%3e%3c/use%3e%3cuse%20xlink:href='%23SD2'%20height='26.769'%20width='26.769'%20x='-111.784'%20y='-119'%3e%3c/use%3e%3cuse%20xlink:href='%23SD2'%20height='70'%20width='70'%20x='-35'%20y='-135.501'%3e%3c/use%3e%3cg%20transform='rotate(180)'%3e%3cuse%20xlink:href='%23VD2'%20height='32'%20width='32'%20x='-114.4'%20y='-156'%3e%3c/use%3e%3cuse%20xlink:href='%23SD2'%20height='26.769'%20width='26.769'%20x='-111.784'%20y='-119'%3e%3c/use%3e%3cuse%20xlink:href='%23SD2'%20height='70'%20width='70'%20x='-35'%20y='-135.501'%3e%3c/use%3e%3c/g%3e%3c/svg%3e",P="data:image/svg+xml,%3c?xml%20version='1.0'%20encoding='UTF-8'%20standalone='no'?%3e%3csvg%20xmlns='http://www.w3.org/2000/svg'%20xmlns:xlink='http://www.w3.org/1999/xlink'%20class='card'%20face='2H'%20height='3.5in'%20preserveAspectRatio='none'%20viewBox='-120%20-168%20240%20336'%20width='2.5in'%3e%3cdefs%3e%3csymbol%20id='SH2'%20viewBox='-600%20-600%201200%201200'%20preserveAspectRatio='xMinYMid'%3e%3cpath%20d='M0%20-300C0%20-400%20100%20-500%20200%20-500C300%20-500%20400%20-400%20400%20-250C400%200%200%20400%200%20500C0%20400%20-400%200%20-400%20-250C-400%20-400%20-300%20-500%20-200%20-500C-100%20-500%200%20-400%20-0%20-300Z'%20fill='red'%3e%3c/path%3e%3c/symbol%3e%3csymbol%20id='VH2'%20viewBox='-500%20-500%201000%201000'%20preserveAspectRatio='xMinYMid'%3e%3cpath%20d='M-225%20-225C-245%20-265%20-200%20-460%200%20-460C%20200%20-460%20225%20-325%20225%20-225C225%20-25%20-225%20160%20-225%20460L225%20460L225%20300'%20stroke='red'%20stroke-width='80'%20stroke-linecap='square'%20stroke-miterlimit='1.5'%20fill='none'%3e%3c/path%3e%3c/symbol%3e%3c/defs%3e%3crect%20width='239'%20height='335'%20x='-119.5'%20y='-167.5'%20rx='12'%20ry='12'%20fill='white'%20stroke='black'%3e%3c/rect%3e%3cuse%20xlink:href='%23VH2'%20height='32'%20width='32'%20x='-114.4'%20y='-156'%3e%3c/use%3e%3cuse%20xlink:href='%23SH2'%20height='26.769'%20width='26.769'%20x='-111.784'%20y='-119'%3e%3c/use%3e%3cuse%20xlink:href='%23SH2'%20height='70'%20width='70'%20x='-35'%20y='-135.501'%3e%3c/use%3e%3cg%20transform='rotate(180)'%3e%3cuse%20xlink:href='%23VH2'%20height='32'%20width='32'%20x='-114.4'%20y='-156'%3e%3c/use%3e%3cuse%20xlink:href='%23SH2'%20height='26.769'%20width='26.769'%20x='-111.784'%20y='-119'%3e%3c/use%3e%3cuse%20xlink:href='%23SH2'%20height='70'%20width='70'%20x='-35'%20y='-135.501'%3e%3c/use%3e%3c/g%3e%3c/svg%3e",I="data:image/svg+xml,%3c?xml%20version='1.0'%20encoding='UTF-8'%20standalone='no'?%3e%3csvg%20xmlns='http://www.w3.org/2000/svg'%20xmlns:xlink='http://www.w3.org/1999/xlink'%20class='card'%20face='2S'%20height='3.5in'%20preserveAspectRatio='none'%20viewBox='-120%20-168%20240%20336'%20width='2.5in'%3e%3cdefs%3e%3csymbol%20id='SS2'%20viewBox='-600%20-600%201200%201200'%20preserveAspectRatio='xMinYMid'%3e%3cpath%20d='M0%20-500C100%20-250%20355%20-100%20355%20185A150%20150%200%200%201%2055%20185A10%2010%200%200%200%2035%20185C35%20385%2085%20400%20130%20500L-130%20500C-85%20400%20-35%20385%20-35%20185A10%2010%200%200%200%20-55%20185A150%20150%200%200%201%20-355%20185C-355%20-100%20-100%20-250%200%20-500Z'%20fill='black'%3e%3c/path%3e%3c/symbol%3e%3csymbol%20id='VS2'%20viewBox='-500%20-500%201000%201000'%20preserveAspectRatio='xMinYMid'%3e%3cpath%20d='M-225%20-225C-245%20-265%20-200%20-460%200%20-460C%20200%20-460%20225%20-325%20225%20-225C225%20-25%20-225%20160%20-225%20460L225%20460L225%20300'%20stroke='black'%20stroke-width='80'%20stroke-linecap='square'%20stroke-miterlimit='1.5'%20fill='none'%3e%3c/path%3e%3c/symbol%3e%3c/defs%3e%3crect%20width='239'%20height='335'%20x='-119.5'%20y='-167.5'%20rx='12'%20ry='12'%20fill='white'%20stroke='black'%3e%3c/rect%3e%3cuse%20xlink:href='%23VS2'%20height='32'%20width='32'%20x='-114.4'%20y='-156'%3e%3c/use%3e%3cuse%20xlink:href='%23SS2'%20height='26.769'%20width='26.769'%20x='-111.784'%20y='-119'%3e%3c/use%3e%3cuse%20xlink:href='%23SS2'%20height='70'%20width='70'%20x='-35'%20y='-135.501'%3e%3c/use%3e%3cg%20transform='rotate(180)'%3e%3cuse%20xlink:href='%23VS2'%20height='32'%20width='32'%20x='-114.4'%20y='-156'%3e%3c/use%3e%3cuse%20xlink:href='%23SS2'%20height='26.769'%20width='26.769'%20x='-111.784'%20y='-119'%3e%3c/use%3e%3cuse%20xlink:href='%23SS2'%20height='70'%20width='70'%20x='-35'%20y='-135.501'%3e%3c/use%3e%3c/g%3e%3c/svg%3e",w="w-[6rem] h-[9rem]",j=[{cards:[{suit:C.Clubs,rank:1,cardImg:L},{suit:C.Diamonds,rank:1,cardImg:f}],behavior:v.MoveAllNextSiblings,hasDropTarget:!0,position:{x:30,y:30}},{cards:[{suit:C.Diamonds,rank:1,cardImg:f}],behavior:v.MoveAllNextSiblings,hasDropTarget:!0,position:{x:180,y:30}},{cards:[{suit:C.Hearts,rank:1,cardImg:P}],behavior:v.MoveAllNextSiblings,hasDropTarget:!0,position:{x:330,y:30}},{cards:[{suit:C.Spades,rank:1,cardImg:I}],behavior:v.MoveAllNextSiblings,hasDropTarget:!0,position:{x:480,y:30}},{cards:[],behavior:v.MoveIndividually,hasDropTarget:!0,position:{x:30,y:200}},{cards:[],behavior:v.MoveIndividually,hasDropTarget:!0,position:{x:180,y:200}},{cards:[],behavior:v.MoveIndividually,hasDropTarget:!0,position:{x:330,y:200}},{cards:[],behavior:v.MoveIndividually,hasDropTarget:!0,position:{x:480,y:200}}];class T{trackedObjDragMoveCallback;trackedObjDragEndCallback;canvasPointerClientX;canvasPointerClientY;usageCount;currentDragData;dragStateChangeListeners;dropCallback;constructor(e){this.trackedObjDragMoveCallback=void 0,this.trackedObjDragEndCallback=void 0,this.canvasPointerClientX=-1,this.canvasPointerClientY=-1,this.usageCount=0,this.currentDragData=null,this.dragStateChangeListeners=new Set,this.dropCallback=e}setDragData(e){this.currentDragData=e,this.dragStateChangeListeners.forEach(a=>a(this.currentDragData))}addDragStateChangeListener(e){this.dragStateChangeListeners.add(e),this.usageCount===0&&document.body.addEventListener("pointermove",this.trackCanvasPointer),this.usageCount++}removedragStateChangeListener(e){this.dragStateChangeListeners.delete(e),this.usageCount--,this.usageCount===0&&document.body.removeEventListener("pointermove",this.trackCanvasPointer)}trackCanvasPointer=e=>{const a=e.clientX-this.canvasPointerClientX,r=e.clientY-this.canvasPointerClientY;this.trackedObjDragMoveCallback&&this.trackedObjDragMoveCallback(a,r),this.canvasPointerClientX=e.clientX,this.canvasPointerClientY=e.clientY};registerPointerReleaseCallbacks=()=>{document.body.addEventListener("pointerup",this.handlePointerReleaseNative),document.body.addEventListener("pointerleave",this.handlePointerInvalidNative),document.body.addEventListener("pointercancel",this.handlePointerInvalidNative)};unregisterPointerReleaseCallbacks=()=>{document.body.removeEventListener("pointerup",this.handlePointerReleaseNative),document.body.removeEventListener("pointerleave",this.handlePointerInvalidNative),document.body.removeEventListener("pointercancel",this.handlePointerInvalidNative)};handlePointerReleaseNative=e=>{this.currentDragData&&this.dropCallback(this.currentDragData),this.clearActiveDragHandler()};handlePointerInvalidNative=e=>{this.clearActiveDragHandler()};setActiveDragHandler=(e,a,r)=>{if(this.trackedObjDragMoveCallback){console.warn("Already in drag mode");return}this.trackedObjDragMoveCallback=a,this.trackedObjDragEndCallback=r,this.registerPointerReleaseCallbacks(),this.setDragData(e)};clearActiveDragHandler=()=>{if(!this.trackedObjDragMoveCallback){console.warn("Unable to clear drag object. Not currently dragging an element.");return}this.trackedObjDragMoveCallback=void 0,this.trackedObjDragEndCallback&&this.trackedObjDragEndCallback(),this.trackedObjDragEndCallback=void 0,this.unregisterPointerReleaseCallbacks(),this.setDragData(null)}}class R{cardStacks;changeListeners;dragManager;activeDropTarget;canvasElement;constructor(e){this.cardStacks=M(e),this.changeListeners=new Set,this.dragManager=new T(a=>this.tryHandleDrop(a)),this.activeDropTarget=null,this.canvasElement=null}touchInterceptor(e){e.preventDefault()}getCanvas(){return this.canvasElement}setCanvas(e){this.canvasElement&&(this.canvasElement.removeEventListener("touchmove",this.touchInterceptor),this.canvasElement.removeEventListener("touchstart",this.touchInterceptor)),this.canvasElement=e,this.canvasElement&&(this.canvasElement.addEventListener("touchmove",this.touchInterceptor),this.canvasElement.addEventListener("touchstart",this.touchInterceptor))}getCardStacks(){return this.cardStacks}setActiveDragHandler(e,a,r){this.dragManager.setActiveDragHandler(e,a,r)}addDragStateChangeListener(e){this.dragManager.addDragStateChangeListener(e)}removeDragStateChangeListener(e){this.dragManager.removedragStateChangeListener(e)}setActiveDropTarget(e){this.activeDropTarget=e}clearActiveDropTarget(){this.activeDropTarget=null}tryHandleDrop(e){this.activeDropTarget?(this.moveBetweenStacks(e,this.activeDropTarget),this.notifyContextStateChange(!0)):this.notifyContextStateChange(!1),this.clearActiveDropTarget()}addChangeListener(e){this.changeListeners.add(e)}removeChangeListener(e){this.changeListeners.delete(e)}notifyContextStateChange(e){this.changeListeners.forEach(a=>a(e))}moveBetweenStacks(e,a){const r=e.stackIndex;if(r===-1){console.warn("Unable to move card. Source stack is invalid");return}const n=a.stackIndex;if(n===-1){console.warn("Unable to move card. Target stack is invalid");return}const o=[...this.cardStacks];switch(this.cardStacks[e.stackIndex].behavior){case v.MoveAllNextSiblings:{const i={...this.cardStacks[r]},c=i.cards.slice(0,e.cardIndex),h=i.cards.slice(e.cardIndex);c.length===i.cards.length&&console.warn("Something went wrong with card removal"),i.cards=c,o[r]=i;const d={...this.cardStacks[n]},g=[...d.cards];g.splice(a.cardIndex,0,...h),d.cards=g,o[n]=d;break}case v.MoveIndividually:{const i={...this.cardStacks[r]},c=[...i.cards],h=c.splice(e.cardIndex,1);c.length===i.cards.length&&console.warn("Something went wrong with card removal"),i.cards=c,o[r]=i;const d={...this.cardStacks[n]},g=[...d.cards];g.splice(a.cardIndex,0,...h),d.cards=g,o[n]=d;break}}this.cardStacks=o}}const b=t=>new R(t),k=s.createContext(b([]));function N(){const t=s.useContext(k),[e,a]=s.useState(t.getCardStacks()),r=s.useCallback(n=>{a(n?t.getCardStacks():[...t.getCardStacks()])},[t]);return s.useEffect(()=>(t.addChangeListener(r),()=>t.removeChangeListener(r)),[t]),{cardStacks:e}}function D(){const t=s.useContext(k),[e,a]=s.useState(null),r=s.useCallback(c=>{a(c)},[]);s.useEffect(()=>(t.addDragStateChangeListener(r),()=>t.removeDragStateChangeListener(r)),[t]);const n=s.useCallback((c,h,d)=>{t.setActiveDragHandler(c,h,d)},[t]),o=s.useCallback(c=>{t.setActiveDropTarget(c)},[t]),i=s.useCallback(c=>{t.clearActiveDropTarget()},[t]);return{activeDragInfo:e,setActiveDrag:n,setActiveDrop:o,unsetActiveDrop:i}}function H(t){const e=s.useRef(null),{activeDragInfo:a,setActiveDrop:r,unsetActiveDrop:n}=D(),[o,i]=s.useState(!1),c=s.useMemo(()=>a&&a.stackIndex!==t.stackIndex,[a,t]);return s.useEffect(()=>{const h=e.current;if(h){const d=()=>{c&&(i(!0),r(t))},g=()=>{c&&(i(!1),n(t))};return h.addEventListener("pointerenter",d),h.addEventListener("pointerleave",g),()=>{h.removeEventListener("pointerenter",d),h.removeEventListener("pointerleave",g)}}},[e.current,c,t]),s.useEffect(()=>{a||i(!1)},[a]),{dropTargetRef:e,isActivated:c,isDragOver:o}}function O(t,e){const{setActiveDrag:a}=p.useDragManager(),[r,n]=s.useState({x:e.x,y:e.y}),o=s.useCallback(()=>{n(e)},[e]),i=s.useCallback((u,m)=>{n(x=>({x:x.x+u,y:x.y+m}))},[]),c=s.useCallback(()=>{d(!1),o()},[o]),[h,d]=s.useState(!1),g=s.useCallback(u=>{if(u){const m=x=>{u.hasPointerCapture(x.pointerId)&&u.releasePointerCapture(x.pointerId),d(!0),a(t,i,c),x.preventDefault(),x.stopPropagation()};return u.addEventListener("pointerdown",m),()=>{u.removeEventListener("pointerdown",m)}}},[]);return s.useEffect(()=>{o()},[e]),{draggableRef:g,isBeingDragged:h,currentPosition:r}}function B(){const t=s.useContext(k),[e,a]=s.useState(!1);return{canvasRef:s.useCallback(o=>{if(t.getCanvas()&&o){console.warn("Unable to register canvas element. A canvas is already registered.");return}t.setCanvas(o),a(o!==null)},[]),isCanvasAvailable:e,createCanvasPortal:o=>{const i=t.getCanvas();return i!==null?E.createPortal(o,i):null}}}const p={useModel:N,useDragManager:D,useDropTarget:H,useDraggable:O,useCanvas:B},Y=t=>s.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",className:"card",face:"outline",height:"3.5in",preserveAspectRatio:"none",viewBox:"-120 -168 240 336",width:"2.5in",...t},s.createElement("rect",{width:239,height:335,x:-119.5,y:-167.5,rx:12,ry:12}));function V({stackInfo:t,position:e,...a}){const{dropTargetRef:r,isActivated:n,isDragOver:o}=p.useDropTarget(t);return l.jsx("div",{...a,ref:r,className:"absolute size-fit",style:{left:`${e.x}px`,top:`${e.y}px`,zIndex:t.cardIndex,opacity:n&&o?1:0,pointerEvents:n?"auto":"none"},children:l.jsx(Y,{className:y("fill-gray-300 stroke-gray-900 opacity-30 dark:opacity-50",w)})})}const S=24;function F({cardStack:t,stackInfo:e,position:a,isPreviousSiblingBeingDragged:r,...n}){const{draggableRef:o,isBeingDragged:i,currentPosition:c}=p.useDraggable(e,a),h=s.useMemo(()=>t.behavior===v.MoveAllNextSiblings&&r||i,[r,i]),d=t.behavior===v.MoveAllNextSiblings?c:a,g=s.useMemo(()=>({x:d.x,y:d.y+S}),[d]);return l.jsxs(l.Fragment,{children:[l.jsx("div",{...n,ref:o,className:"absolute size-fit",style:{transform:`translateX(${c.x}px) translateY(${c.y}px)`,zIndex:h?e.cardIndex+100:e.cardIndex,pointerEvents:h?"none":"auto"},children:l.jsx("img",{src:t.cards[e.cardIndex].cardImg,className:y("",w),draggable:!1})}),l.jsx(A,{cardStack:t,stackInfo:{...e,cardIndex:e.cardIndex+1},position:g,isPreviousSiblingBeingDragged:h})]})}function A({cardStack:t,stackInfo:e,position:a,isPreviousSiblingBeingDragged:r,...n}){return e.cardIndex<t.cards.length?l.jsx(F,{...n,cardStack:t,stackInfo:e,position:a,isPreviousSiblingBeingDragged:r}):t.hasDropTarget&&l.jsx(V,{stackInfo:{...e,cardIndex:t.cards.length},position:{x:t.position.x,y:t.position.y+t.cards.length*S}})}const U=t=>s.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",className:"card",face:"outline",height:"3.5in",preserveAspectRatio:"none",viewBox:"-120 -168 240 336",width:"2.5in",...t},s.createElement("rect",{width:239,height:335,x:-119.5,y:-167.5,rx:12,ry:12,fill:"transparent",strokeDasharray:"20,10"}));function X({cardStack:t,stackIndex:e,...a}){return l.jsxs(l.Fragment,{children:[l.jsx("div",{...a,className:"absolute size-fit",style:{left:`${t.position.x}px`,top:`${t.position.y}px`,zIndex:-10,pointerEvents:"none"},children:l.jsx(U,{className:y("stroke-gray-700 dark:stroke-gray-300",w)})}),l.jsx(A,{cardStack:t,stackInfo:{stackIndex:e,cardIndex:0},position:t.position})]})}function _({}){const{canvasRef:t,isCanvasAvailable:e}=p.useCanvas(),{cardStacks:a}=p.useModel();return l.jsx("div",{ref:t,className:"relative",children:e&&a.map((r,n)=>l.jsx(X,{cardStack:r,stackIndex:n},`card-stack-${n}`))})}function z(){return l.jsxs("div",{className:"p-3 select-none",children:[l.jsx("h1",{className:"mb-3",children:"Playing Cards"}),l.jsxs("div",{className:"pb-3",children:[l.jsx("div",{children:"The following is an exploration of drag-n-drop behavior while staying within React, not using the HTML drag and drop API and not using any dnd libraries."}),l.jsx("div",{children:"The top row allows moving cards as a stack. The bottom row allows moving cards individually."})]}),l.jsx(k,{value:b(j),children:l.jsx(_,{})})]})}const q=z;export{q as component};
